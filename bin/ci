#!/usr/bin/env bash
set -e

echo "ğŸ”’ Security checks"
bundle exec brakeman -q -o tmp/brakeman.html
bundle exec bundle audit check --update

echo "ğŸ“¦ Checking for unused gems"
bundle exec bundle clean --force

echo "ğŸ” Checking for database consistency"
bundle exec database_consistency

echo "ğŸ“ Updating annotations"
bundle exec annotaterb models

echo "ğŸ§¹ Linting Ruby code"
bundle exec rubocop -A

echo "ğŸ” Checking for problems with activerecord"
bundle exec rake active_record_doctor

echo "âš¡ Checking for problems with Rails"
bundle exec rails_best_practices .

echo "â¡ï¸ Running tests"
bin/rails rspec

echo "âœ… All checks passed"